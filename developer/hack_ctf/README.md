# Write-ups for northsec

## 2023

### Reverse engenering ++

- Desk Surveillance Publisher
  - <https://niftic.ca/writeups/desk_surveillance_publisher/>
  - Nous avons r√©solu la premi√®re etape avec [desk_surveillance_publisher](2023/desk_surveillance_publisher/desk_surveillance_publisher_step1.py)
  - Les solutions fournies par le d√©velopeur de la track sont [solve#.py](2023/desk_surveillance_publisher/)
  - Code source C utilis√© pour simuler et valider la mechanique [source](2023/desk_surveillance_publisher/step1_sample.c)

      ```
      gcc step1_sample.c -o step1
      ```

- Document Dropper
  - jeu N64 avec Project64 sous windows
  - Soluce

    ```
    Load into ghidra and poke around. 
    See a printflag() function that wasn't referenced anywhere. 
    Look at memory and find references to input. Notice that it is smaller than 64.

    Open project64 in debugger. Play around with options and realize we have a buffer overflow.

    Take adress of printflag function (800279ec... I know it by heart now after entering it 200x...) And  "Drop" the floppy at 80 02, 79 ec repeatedly filling up the buffer.

    Overflow calling printflag()

    (Edit bc forgot the best part):
    Then the fun part. Had to go to the game station and do it all manually using inverted controls on the controller üôÇ 
    ```

    Inspir√© <https://blog.quantumlyconfused.com/ctf/2022/05/22/nsec2022-n64/>
  - Autre soluce <https://blog.quantumlyconfused.com/ctf/2023/05/22/nsec2023-gamestation/>

### Client/Server

- GOD_Code_Pipelines
  - Solution [solve.md](2023/GOD_Code_Pipelines/solve.md)
  - Other hint in hack <https://jackmc.xyz/2022/05/23/nsec-spreadsheet.html>
  - <https://erichogue.ca/2023/05/NorthSec/GODCodePipelines>
  - <https://hubert.hackin.ca/posts/nsec23-code-pipeline-1/>

- The brainfuck one, God debaser
  - 2e FLAG
    - <https://gist.github.com/isra17/c0dea400d9806897217bf5fb5b26f080>
    - If you craft a brainfuck program that would create a loop 128 or 127 bytes wide, there was a small error it would emit some code and then recalculate the offset and get a jump farther than 128 bytes, therefor jumping somewhere ahead, giving you the possibility to jump in the middle of an instruction. Next step was to use the add jit code where you can control 32 bits and put whatever instruction you want in it, jump in middle of it, code exec, read local flag, score the points!.

- Rate my workers
  - [soluce](2023/rate_my_workers/solution.md)

- Annual Review
  - [schema](2023/Annual_Review/diagram.png)
  - [Soluce](2023/Annual_Review/walkthrough.md)
  - [Source code](https://github.com/simondotsh/nsec2023-ctf-aws)
  - <https://erichogue.ca/2023/05/NorthSec/AnnualReview>
- Got 99^2 Problems
  - <https://erichogue.ca/2023/05/NorthSec/IGot992Problems>
- Hackademy
  - <https://erichogue.ca/2023/05/NorthSec/HackademyInclusion>
  - <https://lolkatz.github.io/will-hack-for-coffee/2022/05/28/northsec-hackademy.html#automatization>
- Cafetaria
  - <https://hubert.hackin.ca/posts/nsec23-cafeteria/>
- Warmup malicious hypernetwork

  ```python
  import pickle
  pickled_model = pickle.load(open(f"flag7/data.pkl", 'rb'))
  ```

### Crypto/Stenographie/Forensic

- HR Complains
  - <https://sylvainpelissier.gitlab.io/posts/2023-05-23-northsec-hr-complains/>
- Look Within Myself
  - simply binwalked the .jpg and bruteforced the password on the 7-zip archive. Was there more? We probably missed many additional layers of steganography
  - <https://erichogue.ca/2023/05/NorthSec/LookWithinMyself>

### Hardware/Physique

- Badge
  - Liste challenges
    - LED Challenges 1 2 3 and 0
    - UART SPI I2C (maybe order is wrong)
    - 0 was hidden behind an overflow
    - It's a logic analyzer challenge.. harder than the previous pre-release feedbacks I got so we should have added hints but I didn't get the time to it sorry
    - One way to see it to enable solving is to take LED clusters (usually same colors or next to each other) and consider them a wire. Led on = signal high, led off = signal low.
  - Liaison s√©rie, il y a un menu avec help,
    - math [Badge Math](2023/badge_math.py)

- PAD
  - Enable debug [source](2023/pad/enable_debug_pad.py)
  - 1 splash screen: when the device boots there's a flag that flashes very quickly, you could use a phone to get a video and get it that way
  - 2 debug mode: when you get the device the only functionality is a clock and serial port with an option to enable debug mode. the argument is a "pin", that should have been a hint that it was just a number and can be bruteforced. The pin is between 0 and 9999 and it is generated by the device itself the first time it boots, so it would be different for every team
  - 3 once debug mode is enabled there are a bunch of commands that appear, I expected people to try them but the most useful was log_level. There is a flag written to logs under the "flag" tag when the device boots. Either log_level * info or log_level flag info and then reboot the device to see the flag. Small bit of additional trolling, the flag is black text on black background so I would expect this one to be much easier for folks who were using default terminals on mac or windows. Return string was "they say real hackers have black terminals"
  - 4 and 5 SD card: The flag command would error out and give you a path /flags/data/flag.txt but nothing is mounted there so the command fails. You had to figure out that the mount point for the SD card is the fat partition label, so I expected people to use fatlabel to rename the partition to "flags" so that it mounts the card at "/flags". That fails because something is mounted there already, leaving only /flags/data as an option for mount point. You had to hexedit the partition table or recompile fatlabel to let you do that. Running the flag command again would then succeed and also write a flag in the parent directory at /flags/flag.txt. You couldn't go up from the mount point via the UI so to get that flag the inteded solution was a path traversal via a file name, so create a file named aaa and hexedit the filesystem to rename the file ../ and that would get you to /flags/data/../.

    Unfortunately there was an unintended logic bug in my code and inserting/removing the card would unmount the existing /flags partiton once your partition was named "flags". So much easier to solve, most teams got it using this bug.
  - 6 On the SD card there was a deleted partition with a filesystem, easiest path is to recreate the partiton with fdisk and all default options, hard path is to locate and dd the filesystem out of the disk and then mount it with a loop device. On the partition you would get some help for the BLE mesh challenge and a STL model of the  screen device with "FLAG" stenciled on the back. Easiest solution is to use any 3D printer slicer to split the file into parts, and one of the resulting parts would be a very tiny flag (scale it up to read).
  - 7 Wifi AP could be turned on, there was a modbus server on port 502 and getting the flag was as simple as reading the registers.
  - 8 BLE mesh (still unsolved): On the device's screen you would be presented with a list of all BLE mesh commands, one of them was "flag request" and "flag response". I expected people to understand that the badges and the screens were all part of the mesh, so you could have dumped the firmware from the badge (which didn't have ESP's secure boot enabled) and disassembled that code to get a good starting point for writing your own code to interact with the BLE mesh. Most of what I wrote for the badge & screen this year was lifted straight from esp-idf examples so copying from those could have been a path to solve the challenge. Enabling logs on the screen would also get you the BLE mesh net_key and app_key which were needed to interact with the mesh.
  - MODBUS hack <https://github.com/theralfbrown/smod-1>

- ESP32 partag√© entre Badge et PAD
  - How to decompile ESP32 <https://olof-astrand.medium.com/reverse-engineering-of-esp32-flash-dumps-with-ghidra-or-ida-pro-8c7c58871e68>
  - <https://github.com/DzzD/esp32_image_parser.git>
  - git@github.com:tslater2006/esp32_flash_loader.git
  
- ATM
  - <https://hackmd.io/@rayanlecat/SkpuOxDSn> copie local [PDF](2023/ATM_Network_Northsec_2023_HackMD.pdf)
  - <https://blog.evl.red/northsec/ctf/writeup/2023/04/24/nsec-2023-atm.html>
  - <https://github.com/cubermitis/NorthSec2023/tree/master/ATM%20Network>

- Candy Machine
  - [Original source](2023/candy_machine/test1.ino)
  - Solution was : any digits *3 followed by 52912734 followed by either* or #
  - Le fichier .hex peut etre d√©compil√© presque proprement avec Cutter-v2.2.1 en choisissant hex au lieu de celui par defaut [hex](2023/candy_machine/machine.ino.standard.hex)

- CL√© <https://hubert.hackin.ca/posts/nsec23-key/>

## 2022

- <https://github.com/frilox042>
- <https://github.com/hugocarnide>
- <https://github.com/JulienRobitaille>
- <https://github.com/waldo121>

## Tools

- <https://github.com/JackOfMostTrades/gadgetinspector>
- <https://github.com/RsaCtfTool/RsaCtfTool>
- <https://github.com/frohoff/ysoserial>
- Putty pour liaison Serie avec USB disponible
- RSA 2 onion <https://github.com/qbitroot/rsa2onion>
- Reverse shell IPv6

  ```
  listen nc -6 -l 1337
  To use your ip as a url: http://[dead:beef:f00d:babe]:1337/ (the brackets do the magic here)
  If you wanted to use http.server for easy file serving: python -m http.server --bind ::
  Oh and make sure you're using netcat-openbsd and not netcat-traditional (on linux based OSs)
  ```

- Analyse image detection visages `Python face_recognition`